# 主账号、子账号逻辑完善说明

## 1. 小米科技（12分公司）主账号信息

根据查询结果：
- **企业名称**: 小米科技（12分公司）
- **企业ID**: 005a2aaa-3451-404d-b2ba-3a15c43aab92
- **用户ID**: 2452f751-ebc2-4a5f-a7d8-d2a37ee02824
- **用户名**: userb654fac1
- **是否主账号**: True
- **主账号ID**: None（因为是主账号）
- **子账号数量**: 0

## 2. 主账号、子账号逻辑完善

### 2.1 数据模型
- `EnterpriseProfile` 和 `TeacherProfile` 都支持主账号、子账号
- 字段：
  - `is_main_account`: 是否主账号
  - `main_account_id`: 主账号ID（子账号指向主账号）

### 2.2 数据共享逻辑

#### 企业端：
1. **主账号**：
   - 可以查看和管理自己的数据
   - 可以创建和管理子账号
   - 可以查看所有子账号创建的数据（如果需要）

2. **子账号**：
   - 可以查看主账号的数据（宣讲会、职位、人才库等）
   - 创建的数据归属于主账号（使用主账号ID）
   - 不能创建子账号
   - 不能删除主账号的数据

#### 教师端：
1. **主账号**：
   - 可以查看和管理自己的数据
   - 可以创建和管理子账号

2. **子账号**：
   - 可以查看主账号的数据
   - 创建的数据归属于主账号（使用主账号ID）

### 2.3 已完善的API

1. **宣讲会管理** (`backend/app/api/v1/info_sessions.py`):
   - 列表查询：主账号和子账号都可以看到主账号的宣讲会
   - 创建：子账号创建时使用主账号ID
   - 更新：主账号和子账号都可以更新主账号的宣讲会
   - 删除：主账号和子账号都可以删除主账号的宣讲会
   - 邀请学生：主账号和子账号都可以邀请学生
   - 查看报名：主账号和子账号都可以查看报名列表

2. **职位管理** (`backend/app/api/v1/jobs.py`):
   - 列表查询：主账号和子账号都可以看到主账号的职位

3. **人才库管理** (`backend/app/api/v1/enterprise_management.py`):
   - 列表查询：主账号和子账号都可以看到主账号的人才库

### 2.4 服务层

创建了 `backend/app/services/enterprise_service.py` 提供：
- `get_effective_enterprise_id()`: 获取有效的企业ID（子账号返回主账号ID）
- `get_enterprise_ids_for_query()`: 获取用于查询的企业ID列表（主账号+所有子账号）
- `can_manage_enterprise_data()`: 检查是否可以管理指定企业的数据

### 2.5 前端修复

修复了搜索学生时的错误：
- 搜索学生API不需要session_id，可以独立搜索
- 修复了前端调用时的逻辑

## 3. 待完善的功能

1. **学校端主账号、子账号逻辑**：
   - 学校模型目前没有主账号、子账号字段
   - 如果需要，可以添加类似逻辑

2. **数据权限细化**：
   - 可以进一步细化子账号的权限（只读、可编辑等）

3. **数据统计**：
   - 主账号可以查看所有子账号的数据统计

## 4. 使用说明

### 创建子账号
1. 主账号登录
2. 进入"子账号管理"
3. 点击"创建子账号"
4. 填写子账号信息（用户名、密码、真实姓名等）
5. 子账号创建后，会自动关联到主账号

### 子账号使用
1. 子账号登录后，可以：
   - 查看主账号的宣讲会、职位、人才库
   - 创建新的宣讲会、职位（归属于主账号）
   - 邀请学生参加宣讲会
   - 查看报名列表

2. 子账号不能：
   - 创建子账号
   - 删除主账号的数据（可以删除自己创建的）


